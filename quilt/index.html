<html><script>!function(e,t){"use strict";var n=Math.pow(2,-24),r=Math.pow(2,32),s=Math.pow(2,53),i={encode:function(e){function n(e){for(var t=h.byteLength,n=g+e;n>t;)t*=2;if(t!==h.byteLength){var r=f;h=new ArrayBuffer(t),f=new DataView(h);for(var s=g+3>>2,i=0;s>i;++i)f.setUint32(4*i,r.getUint32(4*i))}return c=e,f}function i(){g+=c}function a(e){i(n(8).setFloat64(g,e))}function o(e){i(n(1).setUint8(g,e))}function u(e){for(var t=n(e.length),r=0;r<e.length;++r)t.setUint8(g+r,e[r]);i()}function l(e,t){24>t?o(e<<5|t):256>t?(o(e<<5|24),o(t)):65536>t?(o(e<<5|25),function(e){i(n(2).setUint16(g,e))}(t)):4294967296>t?(o(e<<5|26),function(e){i(n(4).setUint32(g,e))}(t)):(o(e<<5|27),function(e){var t=e%r,s=(e-t)/r,a=n(8);a.setUint32(g,s),a.setUint32(g+4,t),i()}(t))}var c,h=new ArrayBuffer(256),f=new DataView(h),g=0;if(function e(n){var r;if(!1===n)return o(244);if(!0===n)return o(245);if(null===n)return o(246);if(n===t)return o(247);switch(typeof n){case"number":if(Math.floor(n)===n){if(n>=0&&s>=n)return l(0,n);if(n>=-s&&0>n)return l(1,-(n+1))}return o(251),a(n);case"string":var i=[];for(r=0;r<n.length;++r){var c=n.charCodeAt(r);128>c?i.push(c):2048>c?(i.push(192|c>>6),i.push(128|63&c)):55296>c?(i.push(224|c>>12),i.push(128|c>>6&63),i.push(128|63&c)):(c=(1023&c)<<10,c|=1023&n.charCodeAt(++r),c+=65536,i.push(240|c>>18),i.push(128|c>>12&63),i.push(128|c>>6&63),i.push(128|63&c))}return l(3,i.length),u(i);default:var h;if(Array.isArray(n))for(l(4,h=n.length),r=0;h>r;++r)e(n[r]);else if(n instanceof Uint8Array)l(2,n.length),u(n);else{var f=Object.keys(n);for(l(5,h=f.length),r=0;h>r;++r){var g=f[r];e(g),e(n[g])}}}}(e),"slice"in h)return h.slice(0,g);for(var d=new ArrayBuffer(g),p=new DataView(d),w=0;g>w;++w)p.setUint8(w,f.getUint8(w));return d},decode:function(e,s,i){function a(e,t){return b+=t,e}function o(t){return a(new Uint8Array(e,b,t),t)}function u(){var e=new ArrayBuffer(4),t=new DataView(e),r=f(),s=32768&r,i=31744&r,a=1023&r;if(31744===i)i=261120;else if(0!==i)i+=114688;else if(0!==a)return a*n;return t.setUint32(0,s<<16|i<<13|a<<13),t.getFloat32(0)}function l(){return a(v.getFloat32(b),4)}function c(){return a(v.getFloat64(b),8)}function h(){return a(v.getUint8(b),1)}function f(){return a(v.getUint16(b),2)}function g(){return a(v.getUint32(b),4)}function d(){return 255===v.getUint8(b)&&(b+=1,!0)}function p(e){if(24>e)return e;if(24===e)return h();if(25===e)return f();if(26===e)return g();if(27===e)return g()*r+g();if(31===e)return-1;throw"Invalid length encoding"}function w(e){var t=h();if(255===t)return-1;var n=p(31&t);if(0>n||t>>5!==e)throw"Invalid indefinite length element";return n}function y(e,t){for(var n=0;t>n;++n){var r=h();128&r&&(224>r?(r=(31&r)<<6|63&h(),t-=1):240>r?(r=(15&r)<<12|(63&h())<<6|63&h(),t-=2):(r=(15&r)<<18|(63&h())<<12|(63&h())<<6|63&h(),t-=3)),65536>r?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}var v=new DataView(e),b=0;"function"!=typeof s&&(s=function(e){return e}),"function"!=typeof i&&(i=function(){return t});var M=function e(){var n,r,a=h(),f=a>>5,g=31&a;if(7===f)switch(g){case 25:return u();case 26:return l();case 27:return c()}if(0>(r=p(g))&&(2>f||f>6))throw"Invalid length";switch(f){case 0:return r;case 1:return-1-r;case 2:if(0>r){for(var v=[],b=0;(r=w(f))>=0;)b+=r,v.push(o(r));var M=new Uint8Array(b),m=0;for(n=0;n<v.length;++n)M.set(v[n],m),m+=v[n].length;return M}return o(r);case 3:var C=[];if(0>r)for(;(r=w(f))>=0;)y(C,r);else y(C,r);return String.fromCharCode.apply(null,C);case 4:var q;if(0>r)for(q=[];!d();)q.push(e());else for(q=new Array(r),n=0;r>n;++n)q[n]=e();return q;case 5:var U={};for(n=0;r>n||0>r&&!d();++n)U[e()]=e();return U;case 6:return s(e(),r);case 7:switch(r){case 20:return!1;case 21:return!0;case 22:return null;case 23:return t;default:return i(r)}}}();if(b!==e.byteLength)throw"Remaining bytes";return M}};"function"==typeof define&&define.amd?define("cbor/cbor",i):e.CBOR||(e.CBOR=i)}(this);class DriverClient{constructor(e,t,n,r=!1,s,i,a){this.reqs=[],this.reps=[],this.requestId=this.getRequestId(),this.debug=r,this.isGreedy=i,this.errCallback=t,this.closeCallback=n,this.alwaysdebug=!1,this.isConnected=!1;let o=null;s||i||a?o=new InitMessage(s,i,a,this.debug):(r&&(this.alwaysdebug=!0),"function"==typeof e&&(o=new InfoMessage)),this.openWebsocket(o,e)}sendMessage(e,t,n=60){this.alwaysdebug&&(e.cmd.debug=!0);let r=e.toCbor();this.sendRequestObj(r,t,n)}disconnect(){this.ws.close()}openWebsocket(e=null,t=null){this.ws=new WebSocket("ws://localhost:11222/driver",["rep.sp.nanomsg.org"]),this.ws.parent=this,this.ws.binaryType="arraybuffer",this.ws.onmessage=this.messageHandler,this.ws.onopen=(()=>{this.isConnected=!0,this.debug&&console.log("socket open"),null!=e&&this.sendMessage(e,t)}),this.ws.onerror=this.onSocketError,this.ws.onclose=this.onClose}sendRequestObj(e,t,n){let r={id:this.requestId++,parent:this,payload:e,callback:t,send:function(){this.debug&&console.log("attemtping to send request with ID "+this.id),this.timeout=setTimeout(r.send.bind(this),1e3*n);let t=new Uint8Array(e.byteLength+4);new DataView(t.buffer).setUint32(0,this.id),t.set(new Uint8Array(this.payload),4),this.parent.ws.send(t.buffer)}};this.reqs.push(r),r.send()}messageHandler(e){let t=e.data;if(t.byteLength<4)return;let n=new DataView(t).getUint32(0);if(n<2147483648)return void this.parent.err("bad nng header");let r=this.parent.findReqIndex(n);if(-1==r)return void this.parent.err("got reply that doesn't match known request!");clearTimeout(this.parent.reqs[r].timeout);let s={id:n,payload:CBOR.decode(t.slice(4))};"function"==typeof this.parent.reqs[r].callback&&this.parent.reqs[r].callback(s.payload),this.parent.reqs.splice(r,1),this.parent.reps.push(s),this.debug&&console.log(s.payload)}getRequestId(){return Math.floor(2147483647*this.prng())+2147483648}onClose(e){this.parent.isConnected=!1,this.parent.debug&&console.log("socket closed"),"function"==typeof this.parent.closeCallback&&this.parent.closeCallback(e)}onSocketError(e){this.parent.debug&&console.log(e),"function"==typeof this.parent.errCallback&&this.parent.errCallback(e)}err(e){this.debug&&console.log("[DRIVER ERROR]"+e)}findReqIndex(e){let t=0;for(;t<this.reqs.length;t++)if(this.reqs[t].id==e)return t;return-1}prng(){return null==this.rng&&(this.rng=generateRng()),this.rng()}}class Message{constructor(e,t){this.cmd=e,this.bin=t}toCbor(){return CBOR.encode(this)}}class InitMessage extends Message{constructor(e="",t=!1,n="",r=!1){let s={init:{}};""!=e&&(s.init.appid=e),""!=n&&(s.init.onclose=n),t&&(s.init.greedy=!0),r&&(s.init.debug=!0),super(s,null)}}class DeleteMessage extends Message{constructor(e=""){super({delete:{name:e}},null)}}class CheckMessage extends Message{constructor(e=""){super({check:{name:e}},null)}}class WipeMessage extends Message{constructor(e=null){let t={wipe:{}};null!=e&&(t.wipe.targetDisplay=e),super(t,null)}}class InfoMessage extends Message{constructor(){super({info:{}},null)}}class ShowMessage extends Message{constructor(e={vx:5,vy:9,aspect:1.6},t="",n=null){let r={show:{source:"bindata",quilt:{type:"image",settings:e}}};null!=n&&(r.show.targetDisplay=n),super(r,t)}}class CacheMessage extends Message{constructor(e,t={vx:5,vy:9,aspect:1.6},n="",r=!1){super({cache:{show:r,quilt:{name:e,type:"image",settings:t}}},n)}}class ShowCachedMessage extends Message{constructor(e,t=null,n=null){let r={show:{source:"cache",quilt:{name:e}}};null!=t&&(r.show.targetDisplay=t),null!=n&&(r.show.quilt.settings=n),super(r,null)}}function generateRng(){var e,t,n,r,s=function(e){for(var t=0,n=1779033703^e.length;t<e.length;t++)n=(n=Math.imul(n^e.charCodeAt(t),3432918353))<<13|n>>>19;return function(){return n=Math.imul(n^n>>>16,2246822507),n=Math.imul(n^n>>>13,3266489909),(n^=n>>>16)>>>0}}(Date.now().toString());return e=s(),t=s(),n=s(),r=s(),()=>{var s=t<<9,i=5*e;return r^=t,t^=n^=e,e^=r,n^=s,r=r<<11|r>>>21,((i=9*(i<<7|i>>>25))>>>0)/4294967296}}!function(){var e;var t=new URLSearchParams(window.location.search);t.has("q")&&(e=new DriverClient(function(n){"ok"==n.devices[0].state||"hidden"==n.devices[0].state?function(t,n,r){function s(e){setTimeout(function(){window.location.href=t},10)}var i=new XMLHttpRequest;i.responseType="arraybuffer",i.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var t=new ShowMessage({vx:n,vy:r,vtotal:n*r},new Uint8Array(this.response));e.sendMessage(t,s,10)}},i.open("GET",t,!0),i.send()}(t.get("q"),t.get("vx"),t.get("vy")):window.location.href=t.get("q")},null,null,!1,"a",!1,"none"))}();
</script></html>
